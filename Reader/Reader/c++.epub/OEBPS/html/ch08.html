<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>8. I/O Streams</title>
<link rel="stylesheet" type="text/css" href="9780133549003.css"/>
</head>
<body>
<h2 id="ch08"><a id="page_85"/><span class="pd_blue">8.</span> I/O Streams</h2>
<p class="blockquote"><em>What you see is all you get.</em></p>
<p class="attribution"><em>&#8211; Brian W. Kernighan</em></p>
<p class="indenthangingB">&#8226; <a href="ch08.html#ch08lev1sec1">Introduction</a></p>
<p class="indenthangingB">&#8226; <a href="ch08.html#ch08lev1sec2">Output</a></p>
<p class="indenthangingB">&#8226; <a href="ch08.html#ch08lev1sec3">Input</a></p>
<p class="indenthangingB">&#8226; <a href="ch08.html#ch08lev1sec4">I/O State</a></p>
<p class="indenthangingB">&#8226; <a href="ch08.html#ch08lev1sec5">I/O of User-Defined Types</a></p>
<p class="indenthangingB">&#8226; <a href="ch08.html#ch08lev1sec6">Formatting</a></p>
<p class="indenthangingB">&#8226; <a href="ch08.html#ch08lev1sec7">File Streams</a></p>
<p class="indenthangingB">&#8226; <a href="ch08.html#ch08lev1sec8">String Streams</a></p>
<p class="indenthangingB">&#8226; <a href="ch08.html#ch08lev1sec9">Advice</a></p>
<div class="heading">
<h3 id="ch08lev1sec1">8.1. Introduction</h3>
<p class="noindent">The I/O stream library provides formatted and unformatted buffered I/O of text and numeric values.</p>
</div>
<p class="indent">An <span class="EmpStrong">ostream</span> converts typed objects to a stream of characters (bytes):</p>
<div class="image"><img src="graphics/085fig01.jpg" alt="Image"/></div>
<p class="noindent">An <span class="EmpStrong">istream</span> converts a stream of characters (bytes) to typed objects:</p>
<div class="image"><a id="page_86"/><img src="graphics/086fig01.jpg" alt="Image"/></div>
<p class="noindent">The operations on <span class="EmpStrong">istream</span>s and <span class="EmpStrong">ostream</span>s are described in &#167;<a href="ch08.html#ch08lev1sec3">8.3</a> and &#167;<a href="ch08.html#ch08lev1sec2">8.2</a>. The operations are type-safe, type-sensitive, and extensible to handle user-defined types.</p>
<p class="indent">Other forms of user interaction, such as graphical I/O, are handled through libraries that are not part of the ISO standard and therefore not described here.</p>
<p class="indent">These streams can be used for binary I/O, be used for a variety of character types, be locale specific, and use advanced buffering strategies, but these topics are beyond the scope of this book.</p>
<div class="heading">
<h3 id="ch08lev1sec2">8.2. Output</h3>
<p class="noindent">In <span class="EmpStrong">&lt;ostream&gt;</span>, the I/O stream library defines output for every built-in type. Further, it is easy to define output of a user-defined type (&#167;<a href="ch08.html#ch08lev1sec5">8.5</a>). The operator <span class="EmpStrong">&lt;&lt;</span> (&#8220;put to&#8221;) is used as an output operator on objects of type <span class="EmpStrong">ostream</span>; <span class="EmpStrong">cout</span> is the standard output stream and <span class="EmpStrong">cerr</span> is the standard stream for reporting errors. By default, values written to <span class="EmpStrong">cout</span> are converted to a sequence of characters. For example, to output the decimal number <span class="EmpStrong">10</span>, we can write:</p>
</div>
<p class="pre"><span class="EmpStrong">void f()</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; 10;</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">This places the character <span class="EmpStrong">1</span> followed by the character <span class="EmpStrong">0</span> on the standard output stream.</p>
<p class="indent">Equivalently, we could write:</p>
<p class="pre"><span class="EmpStrong">void g()</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">int i {10};</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; i;</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">Output of different types can be combined in the obvious way:</p>
<p class="pre"><span class="EmpStrong">void h(int i)</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; "the value of i is ";</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; i;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; '\n';</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">For <span class="EmpStrong">h(10)</span>, the output will be:</p>
<p class="pre"><a id="page_87"/><span class="EmpStrong">the value of i is 10</span></p>
<p class="noindent">People soon tire of repeating the name of the output stream when outputting several related items. Fortunately, the result of an output expression can itself be used for further output. For example:</p>
<p class="codelink"><a id="p087pro01" href="ch08_images.html#p087pro01a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">void h2(int i)</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; "the value of i is " &lt;&lt; i &lt;&lt; '\n';</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">This <span class="EmpStrong">h2()</span> produces the same output as <span class="EmpStrong">h()</span>.</p>
<p class="indent">A character constant is a character enclosed in single quotes. Note that a character is output as a character rather than as a numerical value. For example:</p>
<p class="codelink"><a id="p087pro02" href="ch08_images.html#p087pro02a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">void k()</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">int b = 'b';</span>&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">note: char implicitly converted to int</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">char c = 'c';</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; 'a' &lt;&lt; b &lt;&lt; c;</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">The integer value of the character <span class="EmpStrong">'b'</span> is <span class="EmpStrong">98</span> (in the ASCII encoding used on the C++ implementation that I used), so this will output <span class="EmpStrong">a98c</span>.</p>
<div class="heading">
<h3 id="ch08lev1sec3">8.3. Input</h3>
<p class="noindent">In <span class="EmpStrong">&lt;istream&gt;</span>, the standard library offers <span class="EmpStrong">istream</span>s for input. Like <span class="EmpStrong">ostream</span>s, <span class="EmpStrong">istream</span>s deal with character string representations of built-in types and can easily be extended to cope with user-defined types.</p>
</div>
<p class="indent">The operator <span class="EmpStrong">&gt;&gt;</span> (&#8220;get from&#8221;) is used as an input operator; <span class="EmpStrong">cin</span> is the standard input stream. The type of the right-hand operand of <span class="EmpStrong">&gt;&gt;</span> determines what input is accepted and what is the target of the input operation. For example:</p>
<p class="codelink"><a id="p087pro03" href="ch08_images.html#p087pro03a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">void f()</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">int i;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cin &gt;&gt; i;</span>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">read an integer into i</span><br/><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">double d;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cin &gt;&gt; d;</span>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">read a double-precision floating-point number into d</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">This reads a number, such as <span class="EmpStrong">1234</span>, from the standard input into the integer variable <span class="EmpStrong">i</span> and a floating-point number, such as <span class="EmpStrong">12.34e5</span>, into the double-precision floating-point variable <span class="EmpStrong">d</span>.</p>
<p class="indent">Like output operations, input operations can be chained, so I could equivalently have written:</p>
<p class="codelink"><a id="page_88"/><a id="p088pro01" href="ch08_images.html#p088pro01a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">void f()</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">int i;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">double d;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cin &gt;&gt; i &gt;&gt; d;</span>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">read into i and d</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">In both cases, the read of the integer is terminated by any character that is not a digit. By default, <span class="EmpStrong">&gt;&gt;</span> skips initial whitespace, so a suitable complete input sequence would be</p>
<p class="pre"><span class="EmpStrong">1234</span><br/><span class="EmpStrong">12.34e5</span></p>
<p class="noindent">Often, we want to read a sequence of characters. A convenient way of doing that is to read into a <span class="EmpStrong">string</span>. For example:</p>
<p class="codelink"><a id="p088pro02" href="ch08_images.html#p088pro02a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">void hello()</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; "Please enter your name\n";</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">string str;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cin &gt;&gt; str;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; "Hello, " &lt;&lt; str &lt;&lt; "!\n";</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">If you type in <span class="EmpStrong">Eric</span> the response is:</p>
<p class="pre"><span class="EmpStrong">Hello, Eric!</span></p>
<p class="noindent">By default, a whitespace character, such as a space or a newline, terminates the read, so if you enter <span class="EmpStrong">Eric Bloodaxe</span> pretending to be the ill-fated king of York, the response is still:</p>
<p class="pre"><span class="EmpStrong">Hello, Eric!</span></p>
<p class="noindent">You can read a whole line (including the terminating newline character) using the <span class="EmpStrong">getline()</span> function. For example:</p>
<p class="codelink"><a id="p088pro03" href="ch08_images.html#p088pro03a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">void hello_line()</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; "Please enter your name\n";</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">string str;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">getline(cin,str);</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; "Hello, " &lt;&lt; str &lt;&lt; "!\n";</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">With this program, the input <span class="EmpStrong">Eric Bloodaxe</span> yields the desired output:</p>
<p class="pre"><span class="EmpStrong">Hello, Eric Bloodaxe!</span></p>
<p class="noindent">The newline that terminated the line is discarded, so <span class="EmpStrong">cin</span> is ready for the next input line.</p>
<p class="indent">The standard strings have the nice property of expanding to hold what you put in them; you don&#8217;t have to precalculate a maximum size. So, if you enter a couple of megabytes of semicolons, the program will echo pages of semicolons back at you.</p>
<div class="heading">
<h3 id="ch08lev1sec4"><a id="page_89"/>8.4. I/O State</h3>
<p class="noindent">An <span class="EmpStrong">iostream</span> has a state that we can examine to determine whether an operation succeeded. The most common use is to read a sequence of values:</p>
</div>
<p class="codelink"><a id="p089pro01" href="ch08_images.html#p089pro01a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">vector&lt;int&gt; read_ints(istream&#38; is)</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;<span class="EmpStrong">vector&lt;int&gt; res;</span><br/>&#160;&#160;&#160;&#160;<span class="EmpStrong">int i;</span><br/>&#160;&#160;&#160;&#160;<span class="EmpStrong">while (is&gt;&gt;i)</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">res.push_back(i);</span><br/>&#160;&#160;&#160;&#160;<span class="EmpStrong">return res;</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">This reads from <span class="EmpStrong">is</span> until something that is not an integer is encountered. That something will typically be the end of input. What is happening here is that the operation <span class="EmpStrong">is&gt;&gt;i</span> returns a reference to <span class="EmpStrong">is</span>, and testing an <span class="EmpStrong">iostream</span> yields <span class="EmpStrong">true</span> if the stream is ready for another operation.</p>
<p class="indent">In general, the I/O state holds all the information needed to read or write, such as formatting information (&#167;<a href="ch08.html#ch08lev1sec6">8.6</a>), error state (e.g., has end-of-input been reached?), and what kind of buffering is used. In particular, a user can set the state to reflect that an error has occurred (&#167;<a href="ch08.html#ch08lev1sec5">8.5</a>) and clear the state if an error wasn&#8217;t serious. For example, we could imagine reading a sequence of integers that might contain some form of nesting:</p>
<p class="codelink"><a id="p089pro02" href="ch08_images.html#p089pro02a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">while (cin) {</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">for (int i; cin&gt;&gt;i;) {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">... use the integer ...</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">if (cin.eof()) {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">.. all is well we reached the end-of-file ...</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">else if (cin.fail()) {</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">a potentially recoverable error</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cin.clear();</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">reset the state to good()</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">char ch;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">if (cin&gt;&gt;ch) {</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">look for nesting represented by { ... }</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">switch (ch) {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">case '{':</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">... start nested structure ...</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">break;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">case '}':</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">... end nested structure ...</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">break;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">default:</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cin.setstate(ios_base::failbit);</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">add fail() to cin's state</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">...</span><br/><span class="EmpStrong">}</span></p>
<div class="heading">
<h3 id="ch08lev1sec5"><a id="page_90"/>8.5. I/O of User-Defined Types</h3>
<p class="noindent">In addition to the I/O of built-in types and standard <span class="EmpStrong">string</span>s, the <span class="EmpStrong">iostream</span> library allows programmers to define I/O for their own types. For example, consider a simple type <span class="EmpStrong">Entry</span> that we might use to represent entries in a telephone book:</p>
</div>
<p class="pre"><span class="EmpStrong">struct Entry {</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">string name;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">int number;</span><br/><span class="EmpStrong">};</span></p>
<p class="noindent">We can define a simple output operator to write an <span class="EmpStrong">Entry</span> using a <em>{"name",number}</em> format similar to the one we use for initialization in code:</p>
<p class="codelink"><a id="p090pro01" href="ch08_images.html#p090pro01a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">ostream&#38; operator&lt;&lt;(ostream&#38; os, const Entry&#38; e)</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">return os &lt;&lt; "{\"" &lt;&lt; e.name &lt;&lt; "\", " &lt;&lt; e.number &lt;&lt; "}";</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">A user-defined output operator takes its output stream (by reference) as its first argument and returns it as its result.</p>
<p class="indent">The corresponding input operator is more complicated because it has to check for correct formatting and deal with errors:</p>
<p class="codelink"><a id="p090pro02" href="ch08_images.html#p090pro02a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">istream&#38; operator&gt;&gt;(istream&#38; is, Entry&#38; e)</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">read { "name", number } pair. Note: formatted with { " " , and }</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">char c, c2;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">if (is&gt;&gt;c &#38;&#38; c=='{' &#38;&#38; is&gt;&gt;c2 &#38;&#38; c2=='"') { //</span> <span class="EmpItalic">start with a { "</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">string name;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">the default value of a string is the empty string: ""</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">while (is.get(c) &#38;&#38; c!='"')</span>&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">anything before a " is part of the name</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">name+=c;</span><br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">if (is&gt;&gt;c &#38;&#38; c==',') {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">int number = 0;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">if (is&gt;&gt;number&gt;&gt;c &#38;&#38; c=='}') { //</span> <span class="EmpItalic">read the number and a }</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">e = {name,number};</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">assign to the entry</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">return is;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">is.state_base::failbit);</span>&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">register the failure in the stream</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">return is;</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">An input operation returns a reference to its <span class="EmpStrong">istream</span> which can be used to test if the operation succeeded. For example, when used as a condition, <span class="EmpStrong">is&gt;&gt;c</span> means &#8220;Did we succeed at reading from <span class="EmpStrong">is</span> into <span class="EmpStrong">c</span>?&#8221;</p>
<p class="indent">The <span class="EmpStrong">is&gt;&gt;c</span> skips whitespace by default, but <span class="EmpStrong">is.get(c)</span> does not, so that this <span class="EmpStrong">Entry</span>-input operator ignores (skips) whitespace outside the name string, but not within it. For example:</p>
<p class="codelink"><a id="page_91"/><a id="p091pro01" href="ch08_images.html#p091pro01a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">{"John Marwood Cleese", 123456</span>&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/><span class="EmpStrong">{"Michael Edward Palin", 987654}</span></p>
<p class="noindent">We can read such a pair of values from input into an <span class="EmpStrong">Entry</span> like this:</p>
<p class="codelink"><a id="p091pro02" href="ch08_images.html#p091pro02a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">for (Entry ee; cin&gt;&gt;ee;)</span>&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">read from cin into ee</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; ee &lt;&lt; '\n';</span>&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">write ee to cout</span></p>
<p class="noindent">The output is:</p>
<p class="codelink"><a id="p091pro03" href="ch08_images.html#p091pro03a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">{ "John Marwood Cleese" , 123456}</span><br/><span class="EmpStrong">{"Michael Edward Palin", 987654}</span></p>
<p class="noindent">See &#167;<a href="ch07.html#ch07lev1sec3">7.3</a> for a more systematic technique for recognizing patterns in streams of characters (regular expression matching).</p>
<div class="heading">
<h3 id="ch08lev1sec6">8.6. Formatting</h3>
<p class="noindent">The <span class="EmpStrong">iostream</span> library provides a large set of operations for controlling the format of input and output. The simplest formatting controls are called <em>manipulators</em> and are found in <span class="EmpStrong">&lt;ios&gt;</span>, <span class="EmpStrong">&lt;istream&gt;</span>, <span class="EmpStrong">&lt;ostream&gt;</span>, and <span class="EmpStrong">&lt;iomanip&gt;</span> (for manipulators that take arguments): For example, we can output integers as decimal (the default), octal, or hexadecimal numbers:</p>
</div>
<p class="codelink"><a id="p091pro04" href="ch08_images.html#p091pro04a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">cout &lt;&lt; 1234 &lt;&lt; ',' &lt;&lt; hex &lt;&lt; 1234 &lt;&lt; ',' &lt;&lt; oct &lt;&lt; 1234 &lt;&lt; '\n';</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">print 1234,4d2,2322</span></p>
<p class="noindent">We can explicitly set the output format for floating-point numbers:</p>
<p class="codelink"><a id="p091pro05" href="ch08_images.html#p091pro05a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">constexpr double d = 123.456;</span><br/><br/><span class="EmpStrong">cout &lt;&lt; d &lt;&lt; "; "</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">use the default format for d</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">&lt;&lt; scientific &lt;&lt;&#160;&#160;d &lt;&lt; "; "</span>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">use 1.123e2 style format for d</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">&lt;&lt; hexfloat &lt;&lt;&#160;&#160;d &lt;&lt; "; "</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">use hexadecimal notation for d</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">&lt;&lt; fixed &lt;&lt; d &lt;&lt; "; "</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">use 123.456 style format for f</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">&lt;&lt; defaultfloat &lt;&lt; d &lt;&lt; '\n';</span>&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">use the default format for d</span></p>
<p class="noindent">This produces:</p>
<p class="pre"><span class="EmpStrong">123.456; 1.234560e+002; 0x1.edd2f2p+6; 123.456000; 123.456</span></p>
<p class="noindent">Precision is an integer that determines the number of digits used to display a floating-point number:</p>
<p class="indenthangingB">&#8226; The <em>general</em> format (<span class="EmpStrong">defaultfloat</span>) lets the implementation choose a format that presents a value in the style that best preserves the value in the space available. The precision specifies the maximum number of digits.</p>
<p class="indenthangingB">&#8226; The <em>scientific</em> format (<span class="EmpStrong">scientific</span>) presents a value with one digit before a decimal point and an exponent. The precision specifies the maximum number of digits after the decimal point.</p>
<p class="indenthangingB">&#8226; The <em>fixed</em> format (<span class="EmpStrong">fixed</span>) presents a value as an integer part followed by a decimal point and a fractional part. The precision specifies the maximum number of digits after the decimal point.</p>
<p class="noindent">Floating-point values are rounded rather than just truncated, and <span class="EmpStrong">precision()</span> doesn&#8217;t affect integer output. For example:</p>
<p class="codelink"><a id="page_92"/><a id="p092pro01" href="ch08_images.html#p092pro01a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">cout.precision(8);</span><br/><span class="EmpStrong">cout &lt;&lt; 1234.56789 &lt;&lt; ' ' &lt;&lt; 1234.56789 &lt;&lt; ' ' &lt;&lt; 123456 &lt;&lt; '\n';</span><br/><br/><span class="EmpStrong">cout.precision(4);</span><br/><span class="EmpStrong">cout &lt;&lt; 1234.56789 &lt;&lt; ' ' &lt;&lt; 1234.56789 &lt;&lt; ' ' &lt;&lt; 123456 &lt;&lt; '\n';</span></p>
<p class="noindent">This produces:</p>
<p class="pre"><span class="EmpStrong">1234.5679 1234.5679 123456</span><br/><span class="EmpStrong">1235 1235 123456</span></p>
<p class="noindent">These manipulators as &#8220;sticky&#8221;; that is, it persists for subsequent floating-point operations.</p>
<div class="heading">
<h3 id="ch08lev1sec7">8.7. File Streams</h3>
<p class="noindent">In <span class="EmpStrong">&lt;fstream&gt;</span>, the standard library provides streams to and from a file:</p>
</div>
<p class="indenthangingB">&#8226; <span class="EmpStrong">ifstream</span>s for reading from a file</p>
<p class="indenthangingB">&#8226; <span class="EmpStrong">ofstream</span>s for writing to a file</p>
<p class="indenthangingB">&#8226; <span class="EmpStrong">fstream</span>s for reading from and writing to a file</p>
<p class="noindent">For example:</p>
<p class="codelink"><a id="p092pro02" href="ch08_images.html#p092pro02a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">ofstream ofs("target");</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">"o"for "output"</span><br/><span class="EmpStrong">if (!ofs)</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">error("couldn't open 'target' for writing");</span></p>
<p class="noindent">Testing that a file stream has been properly opened is usually done by checking its state.</p>
<p class="codelink"><a id="p092pro03" href="ch08_images.html#p092pro03a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">fstream ifs;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">"i"for "input"</span><br/><span class="EmpStrong">if (!ifs)</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">error("couldn't open 'source' for reading");</span></p>
<p class="noindent">Assuming that the tests succeeded, <span class="EmpStrong">ofs</span> can be used as an ordinary <span class="EmpStrong">ostream</span> (just like <span class="EmpStrong">cout</span>) and <span class="EmpStrong">ifs</span> can be used as an ordinary <span class="EmpStrong">istream</span> (just like <span class="EmpStrong">cin</span>).</p>
<p class="indent">File positioning and more detailed control of the way a file is opened is possible, but beyond the scope of this book.</p>
<div class="heading">
<h3 id="ch08lev1sec8">8.8. String Streams</h3>
<p class="noindent">In <span class="EmpStrong">&lt;sstream&gt;</span>, the standard library provides streams to and from a <span class="EmpStrong">string</span>:</p>
</div>
<p class="indenthangingB">&#8226; <span class="EmpStrong">istringstream</span>s for reading from a <span class="EmpStrong">string</span></p>
<p class="indenthangingB">&#8226; <span class="EmpStrong">ostringstream</span>s for writing to a <span class="EmpStrong">string</span></p>
<p class="indenthangingB">&#8226; <span class="EmpStrong">stringstream</span>s for reading from and writing to a <span class="EmpStrong">string</span>.</p>
<p class="noindent">For example:</p>
<p class="codelink"><a id="p092pro04" href="ch08_images.html#p092pro04a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">void test()</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">ostringstream oss;</span><br/><a id="page_93"/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">oss &lt;&lt; "{temperature," &lt;&lt; scientific &lt;&lt; 123.4567890 &lt;&lt; "}";</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">cout &lt;&lt; oss.str() &lt;&lt; '\n';</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">The result from an <span class="EmpStrong">istringstream</span> can be read using <span class="EmpStrong">str()</span>. One common use of an <span class="EmpStrong">ostringstream</span> is to format before giving the resulting string to a GUI. Similarly, a string received from a GUI can be read using formatted input operations (&#167;<a href="ch08.html#ch08lev1sec3">8.3</a>) by putting it into an <span class="EmpStrong">istringstream</span>.</p>
<p class="indent">A <span class="EmpStrong">stringstream</span> can be used for both reading and writing. For example, we can define an operation that can convert any type with a string representation to another that also has a string representation:</p>
<p class="codelink"><a id="p093pro01" href="ch08_images.html#p093pro01a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">template&lt;typename Target =string, typename Source =string&gt;</span><br/><span class="EmpStrong">Target to(Source arg)</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">convert Source to Target</span><br/><span class="EmpStrong">{</span><br/>&#160;&#160;<span class="EmpStrong">stringstream interpreter;</span><br/>&#160;&#160;<span class="EmpStrong">Target result;</span><br/><br/>&#160;&#160;<span class="EmpStrong">if (!(interpreter &lt;&lt; arg)</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">write arg into stream</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">|| !(interpreter &gt;&gt; result)</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">read result from stream</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">|| !(interpreter &gt;&gt; std::ws).eof())</span>&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">stuff left in stream?</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">throw runtime_error{"to&lt;&gt;() failed"};</span><br/><br/>&#160;&#160;<span class="EmpStrong">return result;</span><br/><span class="EmpStrong">}</span></p>
<p class="noindent">A function template argument needs to be explicitly mentioned only if it cannot be deduced or if there is no default, so we can write:</p>
<p class="codelink"><a id="p093pro02" href="ch08_images.html#p093pro02a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">auto x1 = to&lt;string,double&gt;(1.2);</span>&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">very explicit (and verbose)</span><br/><span class="EmpStrong">auto x2 = to&lt;string&gt;(1.2);</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">Source is deduced to double</span><br/><span class="EmpStrong">auto x3 = to&lt;&gt;(1.2);</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">Target is defaulted to string; Source is deduced to double</span><br/><span class="EmpStrong">auto x4 = to(1.2);</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">the &lt;&gt; is redundant;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">//</span> <span class="EmpItalic">Target is defaulted to string; Source is deduced to double</span></p>
<p class="noindent">If all function template arguments are defaulted, the <span class="EmpStrong">&lt;&gt;</span> can be left out.</p>
<p class="indent">I consider this a good example of the generality and ease of use that can be achieved by a combination of language features and standard-library facilities.</p>
<div class="heading">
<h3 id="ch08lev1sec9">8.9. Advice</h3>
<p class="ref">[1] The material in this chapter roughly corresponds to what is described in much greater detail in Chapter 38 of [Stroustrup,2013].</p>
</div>
<p class="ref">[2] <span class="EmpStrong">iostream</span>s are type-safe, type-sensitive, and extensible; &#167;<a href="ch08.html#ch08lev1sec1">8.1</a>.</p>
<p class="ref">[3] Define <span class="EmpStrong">&lt;&lt;</span> and <span class="EmpStrong">&gt;&gt;</span> for user-defined types with values that have meaningful textual representations; &#167;<a href="ch08.html#ch08lev1sec1">8.1</a>, &#167;<a href="ch08.html#ch08lev1sec2">8.2</a>, &#167;<a href="ch08.html#ch08lev1sec3">8.3</a>.</p>
<p class="ref">[4] Use <span class="EmpStrong">cout</span> for normal output and <span class="EmpStrong">cerr</span> for errors; &#167;<a href="ch08.html#ch08lev1sec1">8.1</a>.</p>
<p class="ref">[5] There are <span class="EmpStrong">iostream</span>s for ordinary characters and wide characters, and you can define an <span class="EmpStrong">iostream</span> for any kind of character; &#167;<a href="ch08.html#ch08lev1sec1">8.1</a>.</p>
<p class="ref"><a id="page_94"/>[6] Binary I/O is supported; &#167;<a href="ch08.html#ch08lev1sec1">8.1</a>.</p>
<p class="ref">[7] There are standard <span class="EmpStrong">iostream</span>s for standard I/O streams, files, and <span class="EmpStrong">string</span>s; &#167;<a href="ch08.html#ch08lev1sec2">8.2</a>, &#167;<a href="ch08.html#ch08lev1sec3">8.3</a>, &#167;<a href="ch08.html#ch08lev1sec7">8.7</a>, &#167;<a href="ch08.html#ch08lev1sec8">8.8</a>.</p>
<p class="ref">[8] Chain <span class="EmpStrong">&lt;&lt;</span> operations for a terser notation; &#167;<a href="ch08.html#ch08lev1sec2">8.2</a>.</p>
<p class="ref">[9] Chain <span class="EmpStrong">&gt;&gt;</span> operations for a terser notation; &#167;<a href="ch08.html#ch08lev1sec3">8.3</a>.</p>
<p class="ref1">[10] Input into <span class="EmpStrong">string</span>s does not overflow; &#167;<a href="ch08.html#ch08lev1sec3">8.3</a>.</p>
<p class="ref1">[11] By default <span class="EmpStrong">&gt;&gt;</span> skips initial whitespace; &#167;<a href="ch08.html#ch08lev1sec3">8.3</a>.</p>
<p class="ref1">[12] Use the stream state <span class="EmpStrong">fail</span> to handle potentially recoverable I/O errors; &#167;<a href="ch08.html#ch08lev1sec4">8.4</a>.</p>
<p class="ref1">[13] You can define <span class="EmpStrong">&lt;&lt;</span> and <span class="EmpStrong">&gt;&gt;</span> operators for your own types; &#167;<a href="ch08.html#ch08lev1sec5">8.5</a>.</p>
<p class="ref1">[14] You don&#8217;t need to modify <span class="EmpStrong">istream</span> or <span class="EmpStrong">ostream</span> to add new <span class="EmpStrong">&lt;&lt;</span> and <span class="EmpStrong">&gt;&gt;</span> operators; &#167;<a href="ch08.html#ch08lev1sec5">8.5</a>.</p>
<p class="ref1">[15] Use manipulators to control formatting; &#167;<a href="ch08.html#ch08lev1sec6">8.6</a>.</p>
<p class="ref1">[16] <span class="EmpStrong">precision()</span> specifications apply to all following floating-point output operations; &#167;<a href="ch08.html#ch08lev1sec6">8.6</a>.</p>
<p class="ref1">[17] Floating-point format specifications (e.g., <span class="EmpStrong">scientific</span>) apply to all following floating-point output operations; &#167;<a href="ch08.html#ch08lev1sec6">8.6</a>.</p>
<p class="ref1">[18] <span class="EmpStrong">#include &lt;ios&gt;</span> when using standard manipulators; &#167;<a href="ch08.html#ch08lev1sec6">8.6</a>.</p>
<p class="ref1">[19] <span class="EmpStrong">#include &lt;iomanip&gt;</span> when using standard manipulators taking arguments; &#167;<a href="ch08.html#ch08lev1sec6">8.6</a>.</p>
<p class="ref1">[20] Don&#8217;t try to copy a file stream.</p>
<p class="ref1">[21] Remember to check that a file stream is attached to a file before using it; &#167;<a href="ch08.html#ch08lev1sec7">8.7</a>.</p>
<p class="ref1">[22] Use <span class="EmpStrong">stringstream</span>s for in-memory formatting; &#167;<a href="ch08.html#ch08lev1sec8">8.8</a>.</p>
<p class="ref1">[23] You can define conversions between any two types that both have string representation; &#167;<a href="ch08.html#ch08lev1sec8">8.8</a>.</p>
</body>
</html>